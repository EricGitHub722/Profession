## 数据链路层

**The most important part of context :**
* 点对点信道和广播信道的特点
* 数据链路层的三个基本问题
  * **封装成帧**: 帧是数据链路层传送的基本单位, 有帧头和帧尾, 记录了物理地址, 源地址等信息.
  * **透明传输**: 
  * **差错检测**: 遭遇干扰出现误码, 通过检测码(在帧尾)来查错, 有误码则将帧丢弃.

### 1.使用点对点信道的数据链路层

首先区别两个概念: 链路和数据链路.

链路(Link): 相邻节点的物理线路.

数据链路(Data Link): 链路 + 实现传输协议的硬件和软件设备, 现在最常用的方法是使用**网络适配器**, 一般的适配器都包括了数据链路层和物理层的功能.

数据链路层的协议数据单元叫做**帧**, 

数据链路层的作用: 将网络层交下来的数据(IP数据报)构成帧发送到链路上; 将接收到的帧中的数据取出上交给网络层

#### 三个基本问题

##### 封装成帧

将IP数据报分别添加首部和尾部即构成了帧

接受方如何在比特流中识别出一个帧?
答: 存在帧定界, 可由此分辨每一块帧; 若无帧定界, 则用前导码来识别.

最大传送单元MTU(Maximum Transfer Unit) >= len(帧的数据部分) >> len(帧头 || 帧尾)

如果接收端接收到是不完整的帧, 则会直接丢弃.

##### 透明传输: 指数据链路层对上层交付的传输数据无限制



##### 差错检测

为降低误码率(BER), 一般使用差错检测码检测是否出现比特差错, 在帧中包含相关FCS帧检验字段

奇偶校验: 添加一位奇偶校验位, 使得数据中1的个数为奇数(奇校验)或偶数(偶校验); 但奇偶检验的漏检率较高

循环冗余校验(CRC): 双方约定好生成多项式G(x), 通过计算来判断收到的数据是否产生了误码, 需注意G(x)必须要包含最低次项.
CRC漏检率非常低, 被广泛应用于数据链路层

Attention: 检错码不能定位错误

#### 可靠传输(取自Chapter 9<< 计算机网络(第7版) -- 谢希仁 >>)

##### 基本概念

不可靠传输服务: 仅丢弃有误码的帧.
可靠传输服务: 想办法实现发送端发什么, 接收端就收到什么.

传输差错除了比特差错还包括分组丢失, 分组失序以及分组重复; 并且这些差错不仅出现在数据链路层, 还会出现在其上层.

#### 停止-等待协议SW(Stop and Wait)

有可能出现的情况有: 无差错情况, 出现差错, 确认丢失和确认迟到

**出现超时重传等差错**: 
 * 需要设置一个超时计时器, 否则就会一直接收不到信息; 并且发送方必须保留发送副本, 在收到接收确认时才能删除副本.
 * 分组和确认分组都必须进行编号, 明确接收到了哪个分组, 哪个分组没有接收到.
 * 超时计时器的重传时间需要略大等于平均往返时间.

**确认丢失和确认迟到**
 * 当接收方已经收到之后, 延迟到达的分组则丢弃不要.
 * 当接收方已确认分组丢失后, 要告诉发送方没有收到

**信道利用率**
T: 发送分组时间; RTT: 往返时间(一般速度为2 * 10 ^ 8 m/s); A: 处理确认时间(一般忽略不计); U: 信道利用率.
公式: U = T / (T + RTT).

#### 回退N帧协议GBN(Go Back N) 

该机制是在流水线机制下的网络协议实现的

#### 选择重传协议SR

提高了GBN的效率


#### 点对点协议PPP(Point-to-Point Protocol)

在数据链路层要想使用可靠传输协议, 对于点对点链路现今主流的协议即是**点对点协议**.
PPP协议的组成: 将IP数据报封装到串行链路的方法, 链路控制协议(LCP), 网络控制协议(NCP).

当使用异步传输时, PPP协议使用字节填充来防止对帧边界的错误判断; 同步传输时使用零比特填充(只要有5个连续1就在后面填充0).

PPP协议的工作状态:

### 媒体接入控制

为了实现共享信道而采取两种对应方法: 
(1)静态划分信道
(2)动态媒体接入控制(多点接入)

#### 静态划分信道

存在四种方法: 频分复用(FDM), 时分复用(TDM), 波分复用(WDM), 码分复用(CDM).
最基本的复用就是FDM和TDM.

频分复用: 用户在分配到一定的频带后, 通信过程中自始至终都占用它, 并且其带宽会根据用户数量的多少发生变化.

时分复用: 将时间划分为一段段等长的TDM帧, 每个用户占用帧中固定的时隙.

这两种方法优点是技术成熟简单, 缺点是不够灵活.

波分复用: 实则就是光纤中的FDM, 每个光载波经过合波器后就会在一根光纤上传输. 但光信号传播一段时间会发生衰减, 此时需要光纤放大器对信号进行放大(120KM).

码分复用: 与其对应的是码分多址系统(CDMA), 其由伪随机码生成. 不同的码片序列一定正交(内积为0). 若内积为-1则是与其反码内积.






